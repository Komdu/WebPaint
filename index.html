<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Paint with Zoom</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 0;
            margin: 0;
            color: white;
            overflow: hidden;
            touch-action: none;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü –Ω–∞ —Ñ–æ–Ω–µ */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }
        
        .app-header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.18);
            z-index: 100;
            position: relative;
        }
        
        .app-title {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(to right, #ffffff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .room-info {
    position: fixed;
    top: 19px;
    left: 10px;
    display: flex
;
    align-items: center;
    gap: 10px;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.95rem;
    font-weight: 600;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    z-index: 10000;
    min-width: 200px;
    max-width: 246px;
	}
        
        #roomId {
            font-size: 0.9rem;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: inline-block;
        }
        
        .room-link {
            cursor: pointer;
            background: rgba(255, 255, 255, 0.3);
            padding: 6px 12px;
            border-radius: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 0.85rem;
        }
        
        .room-link:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }
        
        #roomLink {
            margin-left: 6px;
            color: #a0e0ff;
            text-decoration: none;
            border-bottom: 1px dashed rgba(255,255,255,0.5);
            font-size: 0.85rem;
            background: none;
            padding: 6px 10px;
            max-width: none;
        }
        
        #roomLink:hover {
            color: white;
            border-bottom-color: white;
        }
        
        .content-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            width: 100%;
            overflow: hidden;
            padding: 0;
            height: calc(100vh - 60px);
        }
        
        /* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ */
        .glass-panel {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            z-index: 10;
            position: relative;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
            border-radius: 0;
            background: none;
            box-shadow: none;
        }
        
        .top-bar {
            display: flex;
            justify-content: center;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            z-index: 50;
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            gap: 15px;
        }
        
        .tools {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        /* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .tool-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.25);
            padding: 10px 15px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 50;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 14px;
        }
        
        .tool-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .tool-btn.active {
            background: rgba(255, 255, 255, 0.35);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .color-label {
            font-weight: 600;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        input[type="color"] {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 6px;
        }
        
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        
        .size-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .size-label {
            font-weight: 600;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        input[type="range"] {
            width: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            height: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .canvas-container {
            position: relative;
            flex: 1;
            background: rgba(0, 0, 0, 0.1);
            overflow: hidden;
            touch-action: none;
            height: 100%;
            width: 100%;
            z-index: 1;
        }
        
        #paintCanvas {
            background: rgba(255, 255, 255, 0.95);
            cursor: crosshair;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            transform-origin: 0 0;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }
        
        .cursor {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ff5e62;
            border: 2px solid white;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 100;
        }
        
        .users-panel {
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            z-index: 50;
        }
        
        .users-count {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .users-icon {
            font-size: 1.2rem;
            color: #ffffff;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            box-shadow: 0 0 6px rgba(76, 175, 80, 0.5);
        }
        
        .status-dot.connecting {
            background: #FFC107;
            box-shadow: 0 0 6px rgba(255, 193, 7, 0.5);
        }
        
        .status-dot.disconnected {
            background: #F44336;
            box-shadow: 0 0 6px rgba(244, 67, 54, 0.5);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 16px;
            transform: translateX(150%);
            transition: transform 0.4s ease;
            z-index: 9000;
            max-width: 350px;
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
        }
        
        .zoom-btn {
            width: 42px;
            height: 42px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 50%;
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        
        .zoom-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .drag-indicator {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 18px;
            border-radius: 30px;
            font-weight: 600;
            z-index: 100;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }
        
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 12px;
                padding: 10px;
            }
            
            .room-info {
                position: fixed;
                top: 8px;
                left: 8px;
                font-size: 0.85rem;
                z-index: 10000;
                min-width: auto;
                padding: 6px 12px;
                max-width: calc(100% - 16px);
            }
            
            #roomId {
                font-size: 0.8rem;
                max-width: 60px;
            }
            
            .room-link {
                padding: 4px 8px;
                font-size: 0.75rem;
            }
            
            #roomLink {
                font-size: 0.75rem;
                padding: 4px 8px;
            }
            
            .top-bar {
                flex-direction: column;
                gap: 10px;
                padding: 8px;
                top: 5px;
                left: 5px;
                right: 5px;
            }
            
            .tools {
                justify-content: center;
            }
            
            .tool-btn {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            .users-panel {
                flex-direction: column;
                gap: 10px;
                padding: 8px;
                bottom: 5px;
                left: 5px;
                right: 5px;
            }
            
            .zoom-controls {
                bottom: 10px;
                right: 10px;
            }
            
            .zoom-btn {
                width: 36px;
                height: 36px;
                font-size: 1.2rem;
            }
            
            .app-title {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <!-- –§–æ–Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã -->
    <div id="particles-js"></div>
    
    <!-- –ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É -->
    <div class="room-info glass-panel">
        <span id="roomLabel">Room:</span>
        <strong id="roomId" title="Click to copy">Loading...</strong>
        <a href="#" id="roomLink" class="room-link">Copy link</a>
    </div>
    
    <div class="content-container">
        <div class="container">
            <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ - —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ -->
            <div class="glass-panel top-bar">
                <div class="tools">
                    <button id="pencil" class="tool-btn active">‚úèÔ∏è</button>
                    <button id="eraser" class="tool-btn">üßΩ</button>
                    <button id="line" class="tool-btn">üìè</button>
                    <button id="rectangle" class="tool-btn">‚¨ú</button>
                    <button id="circle" class="tool-btn">‚≠ï</button>
                </div>
                <div class="color-picker">
                    <input type="color" id="color" value="#ff5e62">
                    <div class="size-control">
                        <input type="range" id="brushSize" min="1" max="50" value="5">
                    </div>
                </div>
            </div>
            
            <div class="canvas-container" id="canvasContainer">
                <canvas id="paintCanvas"></canvas>
                <div class="glass-panel drag-indicator" id="dragIndicator">Canvas dragging (hold Space)</div>
                <div class="zoom-controls">
                    <button id="zoomIn" class="glass-panel zoom-btn">+</button>
                    <button id="zoomOut" class="glass-panel zoom-btn">‚àí</button>
                    <button id="resetView" class="glass-panel zoom-btn">‚Ü∫</button>
                </div>
            </div>
            
            <div class="glass-panel users-panel">
                <div class="users-count">
                    <span class="users-icon">üë•</span>
                    <span id="usersCount">1</span>
                </div>
                <div class="connection-status">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="statusText">Connecting...</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="glass-panel notification" id="notification">
        <div id="notificationContent"></div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö —á–∞—Å—Ç–∏—Ü -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        let offsetX = 0;
        let offsetY = 0;
        let scale = 1;
        let isDragging = false;
        let lastDragX = 0;
        let lastDragY = 0;
        let isSpacePressed = false;
        let canvasWidth = 0;
        let canvasHeight = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–æ–≤—ã—Ö —á–∞—Å—Ç–∏—Ü
        document.addEventListener('DOMContentLoaded', function() {
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.1, random: true },
                    size: { value: 3, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#ffffff",
                        opacity: 0.05,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 1,
                        direction: "none",
                        random: true,
                        straight: false,
                        out_mode: "out",
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "grab" },
                        onclick: { enable: true, mode: "push" },
                        resize: true
                    }
                },
                retina_detect: true
            });
        });

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const canvas = document.getElementById('paintCanvas');
        const ctx = canvas.getContext('2d');
        const canvasContainer = document.getElementById('canvasContainer');
        const colorPicker = document.getElementById('color');
        const brushSize = document.getElementById('brushSize');
        const usersCount = document.getElementById('usersCount');
        const toolButtons = document.querySelectorAll('.tool-btn');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const notification = document.getElementById('notification');
        const notificationContent = document.getElementById('notificationContent');
        const roomIdElement = document.getElementById('roomId');
        const zoomInBtn = document.getElementById('zoomIn');
        const zoomOutBtn = document.getElementById('zoomOut');
        const resetViewBtn = document.getElementById('resetView');
        const dragIndicator = document.getElementById('dragIndicator');
        const roomLink = document.getElementById('roomLink');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentTool = 'pencil';
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let startX = 0;
        let startY = 0;
        let currentColor = colorPicker.value;
        let currentBrushSize = brushSize.value;
        let socket;
        let userId;
        let roomId;
        let userCursors = {};
        let usersOnline = 1;
        let drawingHistory = [];
        let historyReceived = false;
        let inviteLink = '';
        
        // –¢–µ–∫—Å—Ç—ã –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
        const text = {
            appTitle: "Collaborative Paint",
            roomLabel: "Room:",
            copyText: "Copy link",
            connecting: "Connecting...",
            connected: "‚úÖ Connected",
            disconnected: "‚ùå Disconnected",
            users: " users online",
            dragIndicator: "Canvas dragging (hold Space)",
            notificationConnected: "Connected to room ",
            notificationCopied: "Link copied! Share with friends.",
            notificationError: "Connection error",
            notificationHistory: "Drawing history loaded",
            notificationClear: "Canvas cleared"
        };
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function generateUserId() {
            return 'user-' + Math.random().toString(36).substr(2, 9);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –∫–æ–º–Ω–∞—Ç—ã
        function generateRoomId() {
            return Math.random().toString(36).substr(2, 8);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö–æ–ª—Å—Ç–∞
        function setupCanvas() {
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ö–æ–ª—Å—Ç–∞ –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –æ–∫–Ω–∞
            canvasWidth = window.innerWidth * 2;
            canvasHeight = window.innerHeight * 2;
            
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Ö–æ–ª—Å—Ç–∞
            updateCanvasPosition();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
            initEvents();
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
            createRoomAndConnect();
            
            // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ room-info –≤—Å–µ–≥–¥–∞ –ø–æ–≤–µ—Ä—Ö
            document.querySelector('.room-info').style.zIndex = '10000';
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –º—ã—à–∏
        function getMousePos(canvas, evt) {
            const rect = canvasContainer.getBoundingClientRect();
            let clientX, clientY;
            
            if (evt.type.includes('touch')) {
                clientX = evt.touches[0].clientX;
                clientY = evt.touches[0].clientY;
            } else {
                clientX = evt.clientX;
                clientY = evt.clientY;
            }
            
            // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å —É—á–µ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞ –∏ —Å–º–µ—â–µ–Ω–∏—è
            const x = (clientX - rect.left - offsetX) / scale;
            const y = (clientY - rect.top - offsetY) / scale;
            
            return {
                x: Math.max(0, Math.min(x, canvas.width)),
                y: Math.max(0, Math.min(y, canvas.height))
            };
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Ö–æ–ª—Å—Ç–∞
        function updateCanvasPosition() {
            canvas.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
        function initEvents() {
            // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            canvas.addEventListener('mousemove', updateCursorPosition);
            
            // –°–æ–±—ã—Ç–∏—è –∫–∞—Å–∞–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', stopDrawing);
            
            // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
            colorPicker.addEventListener('input', () => {
                currentColor = colorPicker.value;
            });
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–∏—Å—Ç–∏
            brushSize.addEventListener('input', () => {
                currentBrushSize = brushSize.value;
            });
            
            // –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
            toolButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                    toolButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                    button.classList.add('active');
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
                    currentTool = button.id;
                });
            });
            
            // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–º–Ω–∞—Ç—É
            roomLink.addEventListener('click', copyRoomLink);
            roomIdElement.addEventListener('click', copyRoomLink);
            
            // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
            canvasContainer.addEventListener('wheel', handleZoom, { passive: false });
            zoomInBtn.addEventListener('click', () => zoom(1.2));
            zoomOutBtn.addEventListener('click', () => zoom(0.8));
            resetViewBtn.addEventListener('click', resetView);
            
            // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    isSpacePressed = true;
                    dragIndicator.style.display = 'block';
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (e.code === 'Space') {
                    isSpacePressed = false;
                    dragIndicator.style.display = 'none';
                }
            });
            
            canvas.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', stopDrag);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏
        function handleZoom(e) {
            e.preventDefault();
            
            const rect = canvasContainer.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const zoomIntensity = 0.1;
            const wheel = e.deltaY < 0 ? 1 : -1;
            const zoomFactor = wheel > 0 ? 1 + zoomIntensity : 1 - zoomIntensity;
            
            zoom(zoomFactor, mouseX, mouseY);
        }
        
        // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
        function zoom(factor, centerX, centerY) {
            const prevScale = scale;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
            scale *= factor;
            scale = Math.max(0.1, Math.min(scale, 5));
            
            // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Ü–µ–Ω—Ç—Ä –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Å–º–µ—â–µ–Ω–∏–µ
            if (centerX !== undefined && centerY !== undefined) {
                const containerRect = canvasContainer.getBoundingClientRect();
                const containerX = centerX - containerRect.left;
                const containerY = centerY - containerRect.top;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
                offsetX -= (containerX - offsetX) * (scale / prevScale - 1);
                offsetY -= (containerY - offsetY) * (scale / prevScale - 1);
            }
            
            updateCanvasPosition();
        }
        
        // –°–±—Ä–æ—Å –≤–∏–¥–∞
        function resetView() {
            scale = 1;
            offsetX = 0;
            offsetY = 0;
            updateCanvasPosition();
        }
        
        // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ö–æ–ª—Å—Ç–∞
        function startDrag(e) {
            if (isSpacePressed) {
                e.preventDefault();
                isDragging = true;
                lastDragX = e.clientX;
                lastDragY = e.clientY;
                canvasContainer.style.cursor = 'grabbing';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ö–æ–ª—Å—Ç–∞
        function handleDrag(e) {
            if (isDragging && isSpacePressed) {
                e.preventDefault();
                const deltaX = e.clientX - lastDragX;
                const deltaY = e.clientY - lastDragY;
                
                offsetX += deltaX;
                offsetY += deltaY;
                
                lastDragX = e.clientX;
                lastDragY = e.clientY;
                
                updateCanvasPosition();
            }
        }
        
        // –û–∫–æ–Ω—á–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ö–æ–ª—Å—Ç–∞
        function stopDrag() {
            isDragging = false;
            canvasContainer.style.cursor = 'default';
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
        function createRoomAndConnect() {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–º–Ω–∞—Ç—ã
            userId = generateUserId();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ roomId –≤ URL
            const hash = window.location.hash.substring(1);
            if (hash) {
                roomId = hash;
            } else {
                roomId = generateRoomId();
                window.location.hash = roomId;
            }
            
            // –£–∫–æ—Ä–∞—á–∏–≤–∞–µ–º ID –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const displayRoomId = roomId.length > 9 ? 
                roomId.substring(0, 6) + '...' : roomId;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º ID –∫–æ–º–Ω–∞—Ç—ã
            roomIdElement.textContent = displayRoomId;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
            inviteLink = window.location.href;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            roomIdElement.title = `Room ID: ${roomId}\nFull link: ${inviteLink}\nClick to copy`;
            roomIdElement.style.cursor = 'pointer';
            
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
            connectToServer();
        }
        
        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
        function connectToServer() {
            updateConnectionStatus('connecting', text.connecting);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä
            socket = new WebSocket('https://9b41bea9-c406-4e23-a8b0-4accde7e34fa-00-29xh0hilv19sy.sisko.replit.dev/');
            
            socket.addEventListener('open', () => {
                updateConnectionStatus('connected', text.connected);
                showNotification(text.notificationConnected + roomId + '!');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                sendData({
                    type: 'join',
                    userId: userId,
                    color: currentColor,
                    roomId: roomId
                });
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ä–∏—Å—É–Ω–∫–æ–≤
                if (!historyReceived) {
                    sendData({
                        type: 'requestHistory',
                        userId: userId,
                        roomId: roomId
                    });
                }
            });
            
            socket.addEventListener('message', (event) => {
                try {
                    const data = JSON.parse(event.data);
                    handleServerMessage(data);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', e);
                }
            });
            
            socket.addEventListener('error', (error) => {
                console.error('WebSocket error:', error);
                updateConnectionStatus('disconnected', text.disconnected);
                showNotification(text.notificationError);
            });
            
            socket.addEventListener('close', () => {
                updateConnectionStatus('disconnected', text.disconnected);
                showNotification(text.notificationError);
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        function handleServerMessage(data) {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–æ–º–Ω–∞—Ç
            if (data.roomId !== roomId) return;
            
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            if (data.userId === userId) return;
            
            switch (data.type) {
                case 'draw':
                    drawRemote(data);
                    addToHistory(data);
                    break;
                case 'shape':
                    drawShapeRemote(data);
                    addToHistory(data);
                    break;
                case 'clear':
                    clearCanvas();
                    addToHistory(data);
                    break;
                case 'cursor':
                    updateRemoteCursor(data);
                    break;
                case 'join':
                    handleUserJoin(data);
                    break;
                case 'leave':
                    handleUserLeave(data);
                    break;
                case 'history':
                    replayHistory(data.history);
                    break;
                case 'requestHistory':
                    sendHistory(data.userId);
                    break;
                case 'users':
                    updateUsersCount(data.count);
                    break;
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é
        function addToHistory(action) {
            drawingHistory.push(action);
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        function sendHistory(targetUserId) {
            sendData({
                type: 'history',
                userId: userId,
                targetUserId: targetUserId,
                roomId: roomId,
                history: drawingHistory
            });
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∏—Å—É–Ω–∫–æ–≤
        function replayHistory(history) {
            if (historyReceived) return;
            
            historyReceived = true;
            
            // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
            history.forEach(item => {
                switch (item.type) {
                    case 'draw':
                        drawRemote(item);
                        break;
                    case 'shape':
                        drawShapeRemote(item);
                        break;
                    case 'clear':
                        clearCanvas();
                        break;
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
            drawingHistory = [...history];
            
            showNotification(text.notificationHistory);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus(status, textMessage) {
            statusText.textContent = textMessage;
            statusDot.className = 'status-dot';
            
            switch(status) {
                case 'connecting':
                    statusDot.classList.add('connecting');
                    break;
                case 'connected':
                    statusDot.classList.add('connected');
                    break;
                case 'disconnected':
                    statusDot.classList.add('disconnected');
                    break;
            }
        }
        
        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message) {
            notificationContent.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        function sendData(data) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                // –î–æ–±–∞–≤–ª—è–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–º–Ω–∞—Ç—ã –∫ –¥–∞–Ω–Ω—ã–º
                const dataToSend = {
                    ...data,
                    userId: userId,
                    roomId: roomId
                };
                socket.send(JSON.stringify(dataToSend));
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞
        function updateCursorPosition(e) {
            const pos = getMousePos(canvas, e);
            sendData({
                type: 'cursor',
                x: pos.x,
                y: pos.y,
                color: currentColor
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        function startDrawing(e) {
            if (isSpacePressed) return;
            
            isDrawing = true;
            const pos = getMousePos(canvas, e);
            [lastX, lastY] = [pos.x, pos.y];
            [startX, startY] = [pos.x, pos.y];
        }
        
        function draw(e) {
            if (!isDrawing || isSpacePressed) return;
            
            const pos = getMousePos(canvas, e);
            const currentX = pos.x;
            const currentY = pos.y;
            
            ctx.lineWidth = currentTool === 'eraser' ? currentBrushSize * 2 : currentBrushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            if (currentTool === 'pencil' || currentTool === 'eraser') {
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.strokeStyle = currentTool === 'eraser' ? 'white' : currentColor;
                ctx.stroke();
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                sendData({
                    type: 'draw',
                    fromX: lastX,
                    fromY: lastY,
                    toX: currentX,
                    toY: currentY,
                    color: currentTool === 'eraser' ? 'white' : currentColor,
                    lineWidth: ctx.lineWidth
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                addToHistory({
                    type: 'draw',
                    fromX: lastX,
                    fromY: lastY,
                    toX: currentX,
                    toY: currentY,
                    color: currentTool === 'eraser' ? 'white' : currentColor,
                    lineWidth: ctx.lineWidth
                });
                
                [lastX, lastY] = [currentX, currentY];
            }
        }
        
        function stopDrawing() {
            if (!isDrawing) return;
            
            if (currentTool === 'line' || currentTool === 'rectangle' || currentTool === 'circle') {
                const endX = lastX;
                const endY = lastY;
                
                drawShape(startX, startY, endX, endY);
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                sendData({
                    type: 'shape',
                    shape: currentTool,
                    startX: startX,
                    startY: startY,
                    endX: endX,
                    endY: endY,
                    color: currentColor
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                addToHistory({
                    type: 'shape',
                    shape: currentTool,
                    startX: startX,
                    startY: startY,
                    endX: endX,
                    endY: endY,
                    color: currentColor
                });
            }
            
            isDrawing = false;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        function handleTouchStart(e) {
            if (e.touches.length === 2) {
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
                e.preventDefault();
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                
                const dx = touch1.clientX - touch2.clientX;
                const dy = touch1.clientY - touch2.clientY;
                const initialDistance = Math.sqrt(dx * dx + dy * dy);
                
                canvas.initialDistance = initialDistance;
                canvas.initialScale = scale;
                canvas.initialOffsetX = offsetX;
                canvas.initialOffsetY = offsetY;
                canvas.midX = (touch1.clientX + touch2.clientX) / 2;
                canvas.midY = (touch1.clientY + touch2.clientY) / 2;
            } else if (e.touches.length === 1) {
                // –û–¥–∏–Ω –ø–∞–ª–µ—Ü - —Ä–∏—Å–æ–≤–∞–Ω–∏–µ
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }
        
        function handleTouchMove(e) {
            if (e.touches.length === 2) {
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
                e.preventDefault();
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                
                const dx = touch1.clientX - touch2.clientX;
                const dy = touch1.clientY - touch2.clientY;
                const currentDistance = Math.sqrt(dx * dx + dy * dy);
                
                if (canvas.initialDistance) {
                    const scaleFactor = currentDistance / canvas.initialDistance;
                    scale = canvas.initialScale * scaleFactor;
                    scale = Math.max(0.1, Math.min(scale, 5));
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–¥ –ø–∞–ª—å—Ü–∞–º–∏
                    const rect = canvasContainer.getBoundingClientRect();
                    const currentMidX = (touch1.clientX + touch2.clientX) / 2;
                    const currentMidY = (touch1.clientY + touch2.clientY) / 2;
                    
                    offsetX = canvas.initialOffsetX + (currentMidX - canvas.midX);
                    offsetY = canvas.initialOffsetY + (currentMidY - canvas.midY);
                    
                    updateCanvasPosition();
                }
            } else if (e.touches.length === 1) {
                // –û–¥–∏–Ω –ø–∞–ª–µ—Ü - —Ä–∏—Å–æ–≤–∞–Ω–∏–µ
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }
        
        // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä
        function drawShape(startX, startY, endX, endY) {
            ctx.beginPath();
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = 3;
            
            switch (currentTool) {
                case 'line':
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                    break;
                case 'rectangle':
                    const width = endX - startX;
                    const height = endY - startY;
                    ctx.strokeRect(startX, startY, width, height);
                    break;
                case 'circle':
                    const radius = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                    ctx.arc(startX, startY, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    break;
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
        function clearCanvas() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ—á–∏—Å—Ç–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            sendData({ type: 'clear' });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            addToHistory({ type: 'clear' });
            
            showNotification(text.notificationClear);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        function drawRemote(data) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            const prevStrokeStyle = ctx.strokeStyle;
            const prevLineWidth = ctx.lineWidth;
            
            ctx.beginPath();
            ctx.moveTo(data.fromX, data.fromY);
            ctx.lineTo(data.toX, data.toY);
            ctx.strokeStyle = data.color;
            ctx.lineWidth = data.lineWidth;
            ctx.stroke();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            ctx.strokeStyle = prevStrokeStyle;
            ctx.lineWidth = prevLineWidth;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∏–≥—É—Ä
        function drawShapeRemote(data) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            const prevStrokeStyle = ctx.strokeStyle;
            const prevLineWidth = ctx.lineWidth;
            
            ctx.beginPath();
            ctx.strokeStyle = data.color;
            ctx.lineWidth = 3;
            
            switch (data.shape) {
                case 'line':
                    ctx.moveTo(data.startX, data.startY);
                    ctx.lineTo(data.endX, data.endY);
                    ctx.stroke();
                    break;
                case 'rectangle':
                    const width = data.endX - data.startX;
                    const height = data.endY - data.startY;
                    ctx.strokeRect(data.startX, data.startY, width, height);
                    break;
                case 'circle':
                    const radius = Math.sqrt(Math.pow(data.endX - data.startX, 2) + Math.pow(data.endY - data.startY, 2));
                    ctx.arc(data.startX, data.startY, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    break;
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            ctx.strokeStyle = prevStrokeStyle;
            ctx.lineWidth = prevLineWidth;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ—Ä–æ–≤
        function updateRemoteCursor(data) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –∫—É—Ä—Å–æ—Ä–µ
            userCursors[data.userId] = {
                x: data.x,
                y: data.y,
                color: data.color
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–æ–≤
            updateCursorsDisplay();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–æ–≤
        function updateCursorsDisplay() {
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫—É—Ä—Å–æ—Ä—ã
            document.querySelectorAll('.remote-cursor').forEach(el => el.remove());
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫—É—Ä—Å–æ—Ä—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            for (const userId in userCursors) {
                if (userId !== window.userId) {
                    const cursor = userCursors[userId];
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —ç–∫—Ä–∞–Ω–Ω—ã–µ
                    const screenX = cursor.x * scale + offsetX;
                    const screenY = cursor.y * scale + offsetY;
                    
                    const cursorElement = document.createElement('div');
                    cursorElement.className = 'cursor remote-cursor';
                    cursorElement.style.left = `${screenX}px`;
                    cursorElement.style.top = `${screenY}px`;
                    cursorElement.style.backgroundColor = cursor.color || '#ff5e62';
                    cursorElement.style.borderColor = '#fff';
                    canvasContainer.appendChild(cursorElement);
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function handleUserJoin(data) {
            usersOnline++;
            updateUsersCount(usersOnline);
            showNotification(`New user joined!`);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function handleUserLeave(data) {
            delete userCursors[data.userId];
            usersOnline--;
            updateUsersCount(usersOnline);
            updateCursorsDisplay();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function updateUsersCount(count) {
            usersCount.textContent = count;
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
        function copyRoomLink(e) {
            e.preventDefault();
            
            const textArea = document.createElement('textarea');
            textArea.value = inviteLink;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            roomLink.textContent = "Copied!";
            setTimeout(() => {
                roomLink.textContent = "Copy link";
            }, 2000);
            
            showNotification(text.notificationCopied);
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.addEventListener('load', () => {
            setupCanvas();
            window.userId = userId; // –î–µ–ª–∞–µ–º userId –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–æ–≤ —Å —á–∞—Å—Ç–æ—Ç–æ–π 30 FPS
            setInterval(updateCursorsDisplay, 33);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ö–æ–ª—Å—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–∫–Ω–∞
            canvasWidth = window.innerWidth * 2;
            canvasHeight = window.innerHeight * 2;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            if (historyReceived) {
                replayHistory(drawingHistory);
            }
            
            updateCanvasPosition();
        });
    </script>
</body>
</html>